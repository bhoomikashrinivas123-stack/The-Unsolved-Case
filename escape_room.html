<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Unsolved Case - Escape Room</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #e0e0e0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      background: #0f3460;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 0;
    }

    .main-content {
      padding: 40px;
      min-height: 600px;
      display: flex;
      flex-direction: column;
    }

    .sidebar {
      background: #0a1e35;
      padding: 30px 20px;
      border-left: 2px solid #e94560;
      overflow-y: auto;
      max-height: 600px;
    }

    header {
      margin-bottom: 30px;
      border-bottom: 2px solid #e94560;
      padding-bottom: 15px;
    }

    h1 {
      color: #e94560;
      font-size: 28px;
      margin-bottom: 5px;
    }

    .room-title {
      color: #16c784;
      font-size: 18px;
      font-weight: 600;
    }

    .game-info {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 14px;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-label {
      color: #94a3b8;
      font-weight: 600;
    }

    .info-value {
      color: #16c784;
      font-weight: 700;
    }

    .room-content {
      flex: 1;
    }

    .clues {
      background: rgba(233, 69, 96, 0.1);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 25px;
      border-left: 4px solid #e94560;
    }

    .clues h3 {
      color: #16c784;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .clue-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 6px;
      border-left: 3px solid #16c784;
      font-size: 14px;
      line-height: 1.5;
    }

    .visual-clues {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .clue-image {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #16c784;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .clue-image:hover {
      border-color: #e94560;
      background: rgba(233, 69, 96, 0.15);
      transform: scale(1.05);
    }

    .clue-image-content {
      font-size: 80px;
      margin-bottom: 10px;
    }

    .clue-image-label {
      font-size: 12px;
      color: #94a3b8;
      font-weight: 600;
    }

    .image-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .image-modal.active {
      display: flex;
    }

    .modal-content {
      max-width: 600px;
      max-height: 80vh;
      position: relative;
      background: #0f3460;
      padding: 30px;
      border-radius: 12px;
      border: 2px solid #e94560;
      text-align: center;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #e94560;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
    }

    .modal-image {
      font-size: 200px;
      margin: 20px 0;
    }

    .modal-description {
      font-size: 16px;
      line-height: 1.6;
      color: #e0e0e0;
    }

    .puzzle-section {
      background: rgba(22, 199, 132, 0.1);
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #16c784;
    }

    .puzzle-section h3 {
      color: #16c784;
      margin-bottom: 15px;
      font-size: 16px;
    }

    .puzzle-question {
      margin-bottom: 15px;
      font-size: 15px;
      line-height: 1.6;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    input[type="text"],
    input[type="number"] {
      flex: 1;
      padding: 12px;
      border: 2px solid #16c784;
      background: rgba(22, 199, 132, 0.1);
      color: #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #e94560;
      background: rgba(233, 69, 96, 0.1);
    }

    button {
      padding: 12px 20px;
      background: #e94560;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    button:hover {
      background: #d63850;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    .hint-btn {
      background: #16c784;
      width: 100%;
      margin-top: 10px;
    }

    .hint-btn:hover {
      background: #12a870;
    }

    .message {
      margin-top: 15px;
      padding: 12px;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
      font-weight: 600;
    }

    .message.success {
      background: rgba(22, 199, 132, 0.2);
      color: #16c784;
      border: 2px solid #16c784;
    }

    .message.error {
      background: rgba(233, 69, 96, 0.2);
      color: #e94560;
      border: 2px solid #e94560;
    }

    .sidebar h3 {
      color: #16c784;
      font-size: 16px;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e94560;
    }

    .sidebar-section {
      margin-bottom: 25px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      margin-bottom: 8px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #16c784;
      width: 0%;
      transition: width 0.3s;
    }

    .evidence-list {
      font-size: 13px;
      line-height: 2;
    }

    .evidence-item {
      padding: 8px;
      background: rgba(22, 199, 132, 0.1);
      margin-bottom: 8px;
      border-radius: 4px;
      border-left: 3px solid #16c784;
    }

    .evidence-item.collected {
      color: #16c784;
    }

    .evidence-item.locked {
      color: #94a3b8;
      opacity: 0.6;
    }

    .room-nav {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .room-nav button {
      flex: 1;
      padding: 10px;
      font-size: 13px;
    }

    .final-screen {
      text-align: center;
      padding: 40px;
    }

    .final-screen h2 {
      color: #16c784;
      font-size: 32px;
      margin-bottom: 20px;
    }

    .final-screen p {
      font-size: 16px;
      line-height: 1.8;
      margin-bottom: 15px;
    }

    .final-score {
      background: rgba(22, 199, 132, 0.2);
      padding: 20px;
      border-radius: 8px;
      margin-top: 30px;
      border: 2px solid #16c784;
    }

    .final-score .score-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 15px;
    }

    .final-score .score-item:last-child {
      margin-bottom: 0;
      border-top: 2px solid #16c784;
      padding-top: 10px;
      font-weight: 700;
      font-size: 18px;
      color: #16c784;
    }

    .timer {
      background: rgba(233, 69, 96, 0.2);
      border: 2px solid #e94560;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      color: #e94560;
      font-family: 'Courier New', monospace;
    }

    .timer.warning {
      background: rgba(233, 69, 96, 0.4);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }

      .sidebar {
        border-left: none;
        border-top: 2px solid #e94560;
        max-height: none;
      }

      .main-content {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <header>
        <h1>üîç The Unsolved Case</h1>
        <p class="room-title" id="roomTitle">Room 1: The Crime Scene</p>
        <div class="game-info">
          <div class="info-item">
            <span class="info-label">Room:</span>
            <span class="info-value" id="roomNumber">1/3</span>
          </div>
          <div class="info-item">
            <span class="info-label">Score:</span>
            <span class="info-value" id="score">1000</span>
          </div>
          <div class="info-item">
            <span class="info-label">Hints Used:</span>
            <span class="info-value" id="hintsUsed">0</span>
          </div>
        </div>
      </header>

      <div class="room-content" id="roomContent">
        <!-- Dynamic content loaded here -->
      </div>
    </div>

    <div class="sidebar">
      <div class="sidebar-section">
        <h3>Progress</h3>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <p style="font-size: 13px; color: #94a3b8;" id="progressText">0% Complete</p>
      </div>

      <div class="sidebar-section">
        <h3>Evidence Collected</h3>
        <div class="evidence-list" id="evidenceList">
          <!-- Evidence items loaded here -->
        </div>
      </div>

      <div class="sidebar-section">
        <h3>Suspects</h3>
        <div class="evidence-list" id="suspectList">
          <div class="evidence-item">üî¥ Alex - Diamond Dealer</div>
          <div class="evidence-item">üîµ Ben - Security Guard</div>
          <div class="evidence-item">üü° Clara - Museum Curator</div>
        </div>
      </div>
    </div>
  </div>

  <div class="image-modal" id="imageModal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeImageModal()">√ó</button>
      <div class="modal-image" id="modalImage"></div>
      <div class="modal-description" id="modalDescription"></div>
    </div>
  </div>

  <script>
    // Game State and Data
    const gameState = {
      currentRoom: 0,
      score: 1000,
      hintsUsed: 0,
      solvedRooms: new Set(),
      collectedEvidence: new Set(),
      hints: {},
      timeRemaining: 0,
      timerInterval: null,
      roomTimeExpired: false
    };

    const rooms = [
      {
        id: 0,
        title: "Room 1: The Crime Scene",
        timeLimit: 300, // 5 minutes
        story: "A precious diamond has been stolen from the museum. Three suspects are involved: Alex (diamond dealer), Ben (security guard), and Clara (museum curator). Investigate the crime scene and find visual clues.",
        clues: [
          { type: "text", content: "üìå A note found near the safe: 'Meet at 15:30'" },
          { type: "text", content: "üîç Security log shows a gap between 3 PM and 3:30 PM" },
          { type: "text", content: "üíé The safe was opened with a 4-digit code" },
          { type: "text", content: "üë• Only three people had access that day" }
        ],
        visualClues: [
          { emoji: "üìù", label: "Note Found", description: "A handwritten note found at the crime scene: 'Meet at 15:30'" },
          { emoji: "üïê", label: "Clock", description: "The museum clock shows 3:30 PM - exactly when the alarm triggered" },
          { emoji: "üîí", label: "Safe Lock", description: "High-security safe requires 4-digit code - only opened during the gap" },
          { emoji: "üìä", label: "Security Log", description: "Digital record showing visitor access times" }
        ],
        puzzle: {
          question: "What time was the diamond stolen? (Use format: HH:MM)",
          answer: "15:30",
          hint: "Look at the visual clues - the note and the clock. When did the gap occur?"
        },
        evidence: "Security Log Extract"
      },
      {
        id: 1,
        title: "Room 2: Suspect Interrogation",
        timeLimit: 180, // 3 minutes
        story: "You've narrowed down the time. Now examine visual evidence about each suspect. Study their faces and surroundings to find inconsistencies in their alibis.",
        clues: [
          { type: "text", content: "üó£Ô∏è Alex: 'I was in my shop the whole afternoon'" },
          { type: "text", content: "üó£Ô∏è Ben: 'I was on duty at the north entrance'" },
          { type: "text", content: "üó£Ô∏è Clara: 'I was in my office reviewing documents'" },
          { type: "text", content: "üì± Phone records show Clara made a call at 3:15 PM" }
        ],
        visualClues: [
          { emoji: "üë®", label: "Alex", description: "Diamond dealer - appears calm, surrounded by jewelry displays" },
          { emoji: "üëÆ", label: "Ben", description: "Security guard - wearing uniform, standing at entrance" },
          { emoji: "üë©", label: "Clara", description: "Museum curator - appears nervous, found outside building at 3:15 PM!" },
          { emoji: "üìµ", label: "Phone Records", description: "GPS data shows Clara's location away from office during critical time" }
        ],
        puzzle: {
          question: "Who is lying about their alibi? (Enter: Alex, Ben, or Clara)",
          answer: "clara",
          hint: "Look at the visual evidence of each suspect. The phone records show someone away from their claimed location. Who doesn't match their story?"
        },
        evidence: "Phone Records"
      },
      {
        id: 2,
        title: "Room 3: The Final Code",
        timeLimit: 120, // 2 minutes
        story: "You've identified the suspect! Now examine the visual evidence vault to crack the final code. Study the patterns and symbols carefully.",
        clues: [
          { type: "text", content: "üî¢ The code is 4 digits long" },
          { type: "text", content: "üìå First clue: '15' (from the time of theft)" },
          { type: "text", content: "üìå Second clue: '30' (from the note)" },
          { type: "text", content: "üéØ Combine the clues to form the final code" }
        ],
        visualClues: [
          { emoji: "1Ô∏è‚É£", label: "First Digit", description: "Number 1 - represented by a vertical line (single object)" },
          { emoji: "5Ô∏è‚É£", label: "Second Digit", description: "Number 5 - five pointed star symbols visible" },
          { emoji: "3Ô∏è‚É£", label: "Third Digit", description: "Number 3 - three triangular security markers" },
          { emoji: "0Ô∏è‚É£", label: "Fourth Digit", description: "Number 0 - circular vault door symbol" }
        ],
        puzzle: {
          question: "Enter the 4-digit code to unlock the evidence vault:",
          answer: "1530",
          hint: "The time of theft (15:30) - remove the colon! The visual clues show the digits: 1, 5, 3, 0"
        },
        evidence: "Confession Evidence"
      }
    ];

    // Initialize Game
    function initGame() {
      updateUI();
      loadRoom(0);
    }

    function loadRoom(roomIndex) {
      if (roomIndex >= rooms.length) {
        showFinalScreen();
        return;
      }

      // Clear any existing timer
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
      }

      gameState.currentRoom = roomIndex;
      gameState.roomTimeExpired = false;
      const room = rooms[roomIndex];
      gameState.timeRemaining = room.timeLimit;

      const content = document.getElementById("roomContent");
      const cluesHTML = room.clues.map(clue => {
        if (clue.type === "text") {
          return `<div class="clue-item">${clue.content}</div>`;
        }
      }).join("");

      const visualCluesHTML = room.visualClues ? `
        <div class="visual-clues">
          ${room.visualClues.map((clue, idx) => `
            <div class="clue-image" onclick="openImageModal(${roomIndex}, ${idx})">
              <div class="clue-image-content">${clue.emoji}</div>
              <div class="clue-image-label">${clue.label}</div>
            </div>
          `).join("")}
        </div>
      ` : "";

      content.innerHTML = `
        <div class="timer" id="timerDisplay">‚è±Ô∏è ${formatTime(gameState.timeRemaining)}</div>
        <div class="clues">
          <h3>üìñ Story</h3>
          <p style="margin-bottom: 15px; line-height: 1.6;">${room.story}</p>
          ${visualCluesHTML}
        </div>

        <div class="puzzle-section">
          <h3>üîê Puzzle</h3>
          <div class="puzzle-question">${room.puzzle.question}</div>
          <div class="input-group">
            <input type="text" id="answerInput" placeholder="Enter your answer..." ${gameState.roomTimeExpired ? 'disabled' : ''} />
            <button onclick="submitAnswer()" ${gameState.roomTimeExpired ? 'disabled' : ''}>Submit</button>
          </div>
          <button class="hint-btn" onclick="useHint()" ${gameState.roomTimeExpired ? 'disabled' : ''}>üí° Use Hint (-50 points)</button>
          <div id="message"></div>
        </div>
      `;

      document.getElementById("roomTitle").textContent = room.title;
      document.getElementById("roomNumber").textContent = `${roomIndex + 1}/${rooms.length}`;
      
      if (!gameState.roomTimeExpired) {
        document.getElementById("answerInput").focus();
      }

      // Start timer
      startTimer();
      updateUI();
    }

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function startTimer() {
      gameState.timerInterval = setInterval(() => {
        gameState.timeRemaining--;
        const timerDisplay = document.getElementById("timerDisplay");
        
        if (timerDisplay) {
          timerDisplay.textContent = `‚è±Ô∏è ${formatTime(gameState.timeRemaining)}`;
          
          // Add warning class when less than 30 seconds
          if (gameState.timeRemaining <= 30 && gameState.timeRemaining > 0) {
            timerDisplay.classList.add("warning");
          }
          
          // Time expired
          if (gameState.timeRemaining <= 0) {
            clearInterval(gameState.timerInterval);
            gameState.roomTimeExpired = true;
            timerDisplay.textContent = "‚è±Ô∏è TIME'S UP!";
            
            // Disable input
            const input = document.getElementById("answerInput");
            const buttons = document.querySelectorAll(".puzzle-section button");
            if (input) input.disabled = true;
            buttons.forEach(btn => btn.disabled = true);
            
            // Show timeout message
            const messageEl = document.getElementById("message");
            messageEl.className = "message error";
            messageEl.textContent = "‚ùå Time's up! Moving to next room...";
            
            setTimeout(() => {
              gameState.currentRoom++;
              loadRoom(gameState.currentRoom);
            }, 2000);
          }
        }
      }, 1000);
    }

    function submitAnswer() {
      const input = document.getElementById("answerInput").value.trim().toLowerCase();
      const room = rooms[gameState.currentRoom];
      const messageEl = document.getElementById("message");

      if (input === room.puzzle.answer.toLowerCase()) {
        clearInterval(gameState.timerInterval);
        gameState.solvedRooms.add(gameState.currentRoom);
        gameState.collectedEvidence.add(room.evidence);

        messageEl.className = "message success";
        messageEl.textContent = `‚úÖ Correct! You found the ${room.evidence}`;

        setTimeout(() => {
          gameState.currentRoom++;
          loadRoom(gameState.currentRoom);
        }, 1500);
      } else {
        messageEl.className = "message error";
        messageEl.textContent = "‚ùå Incorrect. Try again!";
      }
    }

    function useHint() {
      const room = rooms[gameState.currentRoom];
      gameState.hintsUsed++;
      gameState.score = Math.max(0, gameState.score - 50);

      const messageEl = document.getElementById("message");
      messageEl.className = "message success";
      messageEl.textContent = `üí° Hint: ${room.puzzle.hint}`;

      updateUI();
    }

    function showFinalScreen() {
      const content = document.getElementById("roomContent");
      content.innerHTML = `
        <div class="final-screen">
          <h2>üéâ Case Solved!</h2>
          <p>You successfully solved "The Unsolved Case" and unmasked the criminal!</p>
          <p><strong>The thief was: Clara (Museum Curator)</strong></p>
          <p>Despite her claims of being in the office, the phone records showed she was away at 3:15 PM. Further investigation revealed she needed money for personal debts and orchestrated the theft.</p>
          
          <div class="final-score">
            <div class="score-item">
              <span>Base Score:</span>
              <span>1000</span>
            </div>
            <div class="score-item">
              <span>Hints Used:</span>
              <span>-${gameState.hintsUsed * 50}</span>
            </div>
            <div class="score-item">
              <span>Final Score:</span>
              <span>${gameState.score}</span>
            </div>
          </div>

          <button onclick="location.reload()" style="margin-top: 30px; width: 100%;">üîÑ Play Again</button>
        </div>
      `;

      document.getElementById("roomTitle").textContent = "Investigation Complete!";
    }

    function updateUI() {
      document.getElementById("score").textContent = gameState.score;
      document.getElementById("hintsUsed").textContent = gameState.hintsUsed;

      const progress = (gameState.solvedRooms.size / rooms.length) * 100;
      document.getElementById("progressFill").style.width = progress + "%";
      document.getElementById("progressText").textContent = Math.round(progress) + "% Complete";

      const evidenceList = document.getElementById("evidenceList");
      evidenceList.innerHTML = Array.from(gameState.collectedEvidence)
        .map(evidence => `<div class="evidence-item collected">‚úÖ ${evidence}</div>`)
        .join("") || '<div class="evidence-item locked">üîí No evidence collected yet</div>';
    }

    // Start the game
    initGame();

    // Image Modal Functions
    function openImageModal(roomIndex, clueIndex) {
      const room = rooms[roomIndex];
      const clue = room.visualClues[clueIndex];
      
      document.getElementById("modalImage").textContent = clue.emoji;
      document.getElementById("modalDescription").innerHTML = `
        <h3 style="color: #16c784; margin-bottom: 15px;">${clue.label}</h3>
        <p>${clue.description}</p>
      `;
      
      document.getElementById("imageModal").classList.add("active");
    }

    function closeImageModal() {
      document.getElementById("imageModal").classList.remove("active");
    }

    // Close modal when clicking outside
    document.getElementById("imageModal").addEventListener("click", function(e) {
      if (e.target === this) {
        closeImageModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") {
        closeImageModal();
      }
    });
  </script>
</body>
</html>
